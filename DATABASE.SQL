SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET AUTOCOMMIT = 0;
START TRANSACTION;
SET TIME_ZONE = "+00:00";

CREATE DATABASE POS_A_LA_CABANIA;

USE POS_A_LA_CABANIA;

CREATE TABLE PRODUCTOS(
	IDPRODUCTOS 				INT(11) 		 NOT NULL AUTO_INCREMENT,
	IDEMPRESA 					INT(11) 		 NOT NULL,
	IDPERSONAS 					INT(11) 		 NOT NULL,
	CODIGOBARRAS				VARCHAR(32)	 NOT NULL,
	NOMBREPRODUCTO 			VARCHAR(200) NOT NULL,
	DESCRIPCIONPRODUCTO VARCHAR(300) NULL,
	MARCA 							VARCHAR(50)  NULL,
	SABOR 							VARCHAR(50)  NULL,
	MEDIDA 							VARCHAR(50)  NULL,
	UNIDAD 							VARCHAR(50)  NULL,
	VALOR 							INT(30) 		 NOT NULL,
	PRECIOCOMPRA 				INT(30) 	   NOT NULL,
	FECHACREACION				VARCHAR(32)  NULL,
	PRIMARY KEY (IDPRODUCTOS)
);
CREATE TABLE DETALLE_PRODUCTOS(
	IDDETALLE_PRODUCTO			INT(11)			NOT NULL AUTO_INCREMENT,
	IDPRODUCTOS					INT(11)			NOT NULL,
	CODIGOBARRAS				VARCHAR(32)	 NOT NULL,
	SABOR 						VARCHAR(50)  NULL,
	PRIMARY KEY (IDDETALLE_PRODUCTO),
	FOREIGN KEY (IDPRODUCTOS) REFERENCES PRODUCTOS(IDPRODUCTOS)
);

CREATE TABLE BODEGA(
	IDBODEGA						INT(11)			NOT NULL AUTO_INCREMENT,
	IDPRODUCTOS					INT(11)			NOT NULL,
	CANTIDAD						INT(11)			NOT NULL,
	PRIMARY KEY (IDBODEGA)
);

CREATE TABLE ESTANTE(
	IDESTANTE						INT(11)			NOT NULL AUTO_INCREMENT,
	IDPRODUCTOS					INT(11)			NOT NULL,
	CANTIDAD						INT(11)			NOT NULL,
	PRIMARY KEY (IDESTANTE)
);

CREATE TABLE MENU(
  IDMENU 							INT(11) 		NOT NULL AUTO_INCREMENT,
  NOMBRE 							VARCHAR(50) NOT NULL,
  DIRECCION 					VARCHAR(70) NOT NULL,
  ACTIVO 							INT(11)			NOT NULL,
  POSICION 						INT(4)			NOT NULL,
  NIVELPERMISO				INT(4)			NOT NULL,
  PRIMARY KEY (IDMENU)
);
CREATE TABLE FACTURA(
	IDFACTURA						INT(11)			NOT NULL AUTO_INCREMENT,
	CONSECUTIVOFACTURA	INT(11)			NOT NULL,
	FECHAVENTA					DATE 				NOT NULL,
	VALORTOTAL					INT(30)			NOT NULL,
	HORAFACTURA 				TIME 				NOT NULL,
	IDPERSONAS 					INT 				NOT NULL,
	IDCLIENTE 					INT 				NOT NULL,
	PAGADO 							BOOLEAN 		NOT NULL,
	PRIMARY KEY (IDFACTURA),
	FOREIGN KEY (IDPERSONAS) REFERENCES PERSONAS (IDPERSONAS),
	FOREIGN KEY (IDCLIENTE) REFERENCES PERSONAS (IDPERSONAS)
);
CREATE TABLE FACTURA_TEMP(
	IDFACTURATEMP				INT(11)			NOT NULL AUTO_INCREMENT,
	CONSECUTIVOFACTURA	INT(11)			NOT NULL,
	FECHAVENTA					DATE       	NOT NULL,
	VALORTOTAL					INT(30)			NOT NULL,
	HORAFACTURA 				TIME 				NOT NULL,
	PRIMARY KEY (IDFACTURATEMP)
);
CREATE TABLE DETALLE_FACTURA(
	IDDETALLEFACTURA		INT(11)			NOT NULL AUTO_INCREMENT,
	IDFACTURA 					INT(11)			NOT NULL,
	IDPRODUCTOS					INT(11)			NOT NULL,
	VALORPRODUCTOS			INT(30)			NOT NULL,
	CANTIDAD						INT(11)			NOT NULL,
	VTOTAL							INT(11)			NOT NULL,
	FECHAVENTA					DATE       	NOT NULL,
	HORAFACTURA 				TIME 				NOT NULL
	PRIMARY KEY (IDDETALLEFACTURA)
);
CREATE TABLE DETALLE_FACTURA_TEMP(
	IDDETALLEFACTURATEMP INT(11)		NOT NULL AUTO_INCREMENT,
	IDFACTURATEMP  			INT(11)			NOT NULL,
	IDPRODUCTOS					INT(11)			NOT NULL,
	VALORPRODUCTOS			INT(30)			NOT NULL,
	CANTIDAD						INT(11)			NOT NULL,
	VTOTAL							INT(11)			NOT NULL,
	FECHAVENTA					DATE       	NOT NULL,
	HORAFACTURA 				TIME 				NOT NULL
	PRIMARY KEY (IDDETALLEFACTURATEMP)
);

CREATE TABLE EMPRESA(
	IDEMPRESA						INT(11) 		NOT NULL AUTO_INCREMENT,
	NOMBRES							VARCHAR(32)	NOT NULL,
	PRIMARY KEY (IDEMPRESA)
);

CREATE TABLE PERSONAS (
  IDPERSONAS 					INT(11) 		NOT NULL AUTO_INCREMENT,
  IDEMPRESA						INT(11) 		NULL,
  NOMBRES 						VARCHAR(100)NOT NULL,
  APELLIDOS 					VARCHAR(100)NOT NULL,
  TELEFONO 						VARCHAR(32) NULL,
  CEDULA							VARCHAR(32) NULL,
  TIPO								VARCHAR(32) NOT NULL,
  PRIMARY KEY (IDPERSONAS),
	FOREIGN KEY (IDEMPRESA) REFERENCES EMPRESA (IDEMPRESA)
  );


CREATE TABLE USUARIO(
	IDUSUARIO						INT(11)			NOT NULL AUTO_INCREMENT,
	IDPERSONAS					INT(11)			NULL,
	NOMBRES							VARCHAR(100)NOT NULL,
	PASSWORD						VARCHAR(32)	NOT NULL,
	NIVELUSUARIO				INT(4)			NOT NULL,
	PRIMARY KEY (IDUSUARIO)
);


CREATE TABLE PAGOPEDIDOS(
IDPAGOPEDIDOS					INT(11)		NOT NULL AUTO_INCREMENT,
IDEMPRESA							INT(11)		NOT NULL,
FECHAPAGO							DATE    	NOT NULL,
VALORPAGO							INT(30)		NOT NULL,
OBSERVACION						VARCHAR(64)NOT NULL,
PRIMARY KEY (IDPAGOPEDIDOS)
);

CREATE TABLE ABONOS(
	IDABONOS					INT(11)		NOT NULL AUTO_INCREMENT,
	IDFACTURA					INT(11)		NOT NULL,
	FECHAABONO					DATE		NOT NULL,
	HORAABONO					TIME		NOT NULL,
	VALORABONO					INT(30)		NOT NULL,
	PRIMARY KEY(IDABONOS),
	FOREIGN KEY(IDFACTURA) REFERENCES FACTURA(IDFACTURA)
);

-- INICIO llave foranea
ALTER TABLE BODEGA
	ADD CONSTRAINT FK_BODEGA_PRODUCTOS
	FOREIGN KEY (IDPRODUCTOS) REFERENCES PRODUCTOS(IDPRODUCTOS);

ALTER TABLE ESTANTE
	ADD CONSTRAINT FK_ESTANTE_PRODUCTOS
	FOREIGN KEY (IDPRODUCTOS) REFERENCES PRODUCTOS(IDPRODUCTOS);

ALTER TABLE DETALLE_FACTURA
	ADD CONSTRAINT FK_DETFAC_FACT
	FOREIGN KEY (IDFACTURA) REFERENCES FACTURA(IDFACTURA);

ALTER TABLE DETALLE_FACTURA_TEMP
	ADD CONSTRAINT FK_DETFACTEMP_FACT
	FOREIGN KEY (IDFACTURATEMP) REFERENCES FACTURA_TEMP(IDFACTURATEMP);

ALTER TABLE USUARIO
	ADD CONSTRAINT FK_USUARIO_PERSONAS
	FOREIGN KEY (IDUSUARIO) REFERENCES PERSONAS(IDPERSONAS);


	ALTER TABLE PRODUCTOS
	ADD CONSTRAINT FK_PRODUCTOS_PERSONAS
	FOREIGN KEY (IDPERSONAS) REFERENCES PERSONAS(IDPERSONAS);

	ALTER TABLE PRODUCTOS
	ADD CONSTRAINT FK_PRODUCTOS_EMPRESA
	FOREIGN KEY (IDEMPRESA) REFERENCES EMPRESA(IDEMPRESA);

	ALTER TABLE DETALLE_FACTURA
	ADD CONSTRAINT FK_DETFAC_PRODUCTO
	FOREIGN KEY (IDPRODUCTOS) REFERENCES PRODUCTOS(IDPRODUCTOS);

	ALTER TABLE PAGOPEDIDOS
	ADD CONSTRAINT FK_PAGOPEDI_EMPRES
	FOREIGN KEY (IDEMPRESA) REFERENCES EMPRESA(IDEMPRESA);


    
  

-- FIN llave foranea

-- INICIO inserción datos

INSERT INTO MENU(NOMBRE, DIRECCION, ACTIVO,POSICION,NIVELPERMISO) VALUES('VENTA','venta.php',1,1,0);
INSERT INTO MENU(NOMBRE, DIRECCION, ACTIVO,POSICION,NIVELPERMISO) VALUES('VALOR','inicio.php',1,2,0);
INSERT INTO MENU(NOMBRE, DIRECCION, ACTIVO,POSICION,NIVELPERMISO) VALUES('INVENTARIO','inventario.php',1,3,0);
INSERT INTO MENU(NOMBRE, DIRECCION, ACTIVO,POSICION,NIVELPERMISO) VALUES('PEDIDOS','pedidos.php',0,4,0);
INSERT INTO MENU(NOMBRE, DIRECCION, ACTIVO,POSICION,NIVELPERMISO) VALUES('NUEVO PRODUCTO','agregaProducto.php',1,5,0);
INSERT INTO MENU(NOMBRE, DIRECCION, ACTIVO,POSICION,NIVELPERMISO) VALUES('GESTION','gestion.php',1,6,0);
INSERT INTO MENU(NOMBRE, DIRECCION, ACTIVO,POSICION,NIVELPERMISO) VALUES('EMPRESAS','empresas.php',1,7,0);


commit;


-- FIN inserción datos